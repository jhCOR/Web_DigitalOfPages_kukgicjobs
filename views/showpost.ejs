<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1">
		
		<title>글 조회 페이지</title>
		
		<link href="/public/semantic.min.css" rel="stylesheet" >
		
		
		<style>
			* {
				padding:0;
				margin:0;
				box-sizing:border-box;
			}
			
			html {
				width:100%;
				height:100%;
			}
			
			body {
				width:100%;
				height:100%;
				color: #000;
				background-color: #fff;
			}
					
			.container {
				margin-right: auto;
				margin-left: auto;
				padding-left: 20px;
				padding-right: 20px;
			}
	
			span {
				color: #999;
			}
			
			#titleOutput {
				margin-bottom: 10px;
				line-height: 1.2em;
			}
			
			#contentsOutput {
				margin-top: 10px;
				margin-bottom: 10px;
				line-height: 1.8em;
			}
	  
			#board_title {
				font-size:1.2em;
				font-weight:bold;
				color:teal;
			}
	.align{
		float: left;
	}
	.align2{
		float: right;
		display: inline;
	}
	.hidedbutton{
		display: none;
	}
	.box{
		display: inline;
	}
		</style>
		
		<script src="/public/jquery-3.1.1.min.js"></script>
		<script src="/public/semantic.min.js"></script>
		<link href="/public/cleditor/jquery.cleditor.css" rel="stylesheet" />
		<script src="/public/cleditor/jquery.cleditor.min.js"></script>
		<script>
			$(document).ready(function() {
				var output = $("#contentsOutput").text();
				console.log('output : ' + output);
				
				$("#contentsOutput").html(output);
				 
			});

		</script>

	</head>
	<body>
	
		<div class="container">
			<br>

			<div class="ui raised segment">
				<a class="ui blue ribbon label">게시판</a>
      			<span id="board_title"><%=title %></span>
							
				<div class="ui blue fluid card">
					 <div class="content">
						<% 
						   var curTitle = posts._doc.title;
						   var curContents = posts._doc.contents;						  

						   var curWriter = posts._doc.writer.email; 
						   var curWriterName = posts._doc.writer.name; 
						   var curId = posts._doc._id; 
						   
						   var updated=posts._doc.updated_at;
						   // html-entities module is required in post.js
						   var entities = new Entities();
						   var month=updated.getMonth()+1;
						   var date=updated.getDate();
						   var year=updated.getFullYear();
						   var totalDate=year+'-'+month+'-'+date;
						var unique= posts._doc.num;
						var tem=curContents.replace(/<p>/gi,'');
							<!-- var clearedContents=tem.replace(/</p>/gi,'');class="description" -->
						   var decodedContents = entities.decode(tem);
						   
							  
						%>
						
						<div id="titleOutput" class="header"><%=curTitle %></div>
	   					<div class="meta">
	     						<span class="right floated time"> <%=totalDate %></span>
	     						<span class="category">일반</span>
	   					</div>
	   					<div id="contentsOutput" class="description">
							<%=decodedContents %>
					    </div>
					 </div>
	  				<div class="extra content">
	    				<div class="right floated author">
	      					<img class="ui avatar image" src="/public/author.png"> <%=curWriterName %>
	    				</div>
	  				</div>
					
				</div>
				
                <div class="ui very relaxed selection celled list">
					
				<% 
				var i=0;
				var curPage=page;
				%>
					<a class="ui button"  href='/process/listpost?page=<%=curPage %>&perPage=8'>글 목록</a>

				
					<% if (login_success&&user===curWriter) { %>
					<form class="align"  method="post" action="/process/updatepost">
						<input hidden type="text" name="id" value="<%=posts._id %>">
						<input hidden type="text" name="id" value="<%=curWriter %>">
						<input   class="ui button"  type="submit" value="글 수정" name="" />
					</form> 


					<form   class="align" height="70px" method="post" action="/process/deletepost">
						<input hidden type="text" name="id" value="<%=posts._id %>">
						<input   class="ui button"  type="submit" value="글 삭제" name="" />
					</form> 

				
					<% }%>

					 <!-- <form   class="align" height="70px" method="post" action="/process/scrap">
						<input hidden type="text" name="postId" value="<%=posts._id %>">
						<input hidden type="text" name="postUniqueNum" value="<%=curId %>">
						<input class="ui button"  type="submit" value="스크랩" name="" />
					</form>   -->
				

                    <%  
                        for (var i = 0; i < posts._doc.comments.length; i++){
                           var curCommentContents = posts._doc.comments[i].contents;
						   var curCommentWriter = posts._doc.comments[i].writer;
						   var curCommentWriterName = posts._doc.comments[i].writername;
						   var curCommentId=posts._doc.comments[i]._id;
						   var idforcomment=i;

						   var isrecomments = posts._doc.comments[i].isrecomments;
						   var recommentWriter = posts._doc.comments[i].recommentWriter;
                           %>
                            <div class="item">
                                <div class="ui grid">
                                    <div class="sixteen wide column">
                                        <div class="ui header">
                                            <h4 class="ui left aligned header">
                                                <%=curCommentContents %>
                                            </h4>
                                            <h5 class="ui left aligned orange header">
                                                <%=curCommentWriterName%>
											</h5>
										<div class="box">
										<%  
											for (var k = 0; k < posts._doc.recomments.length; k++){
												var currecommentId=posts._doc.recomments[k].idcard;
												var currecommentContents=posts._doc.recomments[k].contents;
												var currecommentWriter=posts._doc.recomments[k].writer;
												var currecommentWriterName=posts._doc.recomments[k].writername;
											%>
											<% if (currecommentId == curCommentId) {%>
												<h6>
													ㄴ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<%=currecommentContents %>
												</h6>
												<% if (login_success&&user===currecommentWriter) { %>
												<form    class="align2" method="post" action="/process/removerecomment">
													<input hidden type="text" name="deleterecomment" value="<%=k %>">
													<input type="submit" value="삭제" name="" />
												</form> 
												<% }%>
												<h6 style="font-size: 0.8em;">
													&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<%=currecommentWriterName %>
												</h6>
												
												<%}%>
										<% } %>	
									</div>
											<div style="display: none;" id="<%=idforcomment %>" >
												<form class="content ui form" method="post" action="/process/addrecomment">
													<div class="field">
														<input class=".align" type="text" name="recomment" style="width: 600px;" placeholder="댓글 입력"> 
														<input class=".align" type="submit" value="입력" name="" />
													  </div>		
													<input hidden type="text" name="id" value="<%=curId %>">
													<input hidden type="text" name="id2" value="<%=curCommentId %>">
												</form>
											</div>

											<div class="align2" >
												<form   class="align2" method="post" >
													<input hidden type="text" name="id4" value="<%=curCommentId %>">
													<input type="submit" value="취소" name="" /> 
													<!-- 이건 나중에 하기 -->
												</form> 
												<% if (login_success&&user===curCommentWriter) { %>
												<form    class="align2" method="post" action="/process/removecomment">
													<input hidden type="text" name="delete" value="<%=i %>">
													<input type="submit" value="삭제" name="" />
												</form> 
												<% }%>
													<input type="button" value="대댓글"  onclick="show(<%=idforcomment %>)"/>
												
											</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                    <% } %>	

                </div>

                
                
                <div>
                    <form class="content ui form" method="post" action="/process/addcomment">
						<div class="field">
							<label>댓글</label>
							<textarea type="text" name="contents" rows="4" style="width: 600px;" placeholder="댓글내용 입력"></textarea>
				  		</div>		
						<input hidden type="text" name="writerforalert" value="<%=curWriter %>">
                        <input hidden type="text" name="id" value="<%=curId %>">
						<input class="ui submit button" type="submit" value="댓글 추가" name="" />
					</form>
                </div>
                
			
				
			</div>
			
		</div>
			
	</body>
</html>


