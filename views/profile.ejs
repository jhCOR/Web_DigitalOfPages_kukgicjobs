<!DOCTYPE html>
<html>
	<head>
		<!-- Required meta tags -->
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

		<!-- Bootstrap CSS -->
		<link
			rel="stylesheet"
			href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
			integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l"
			crossorigin="anonymous"
		/>
		<link rel="stylesheet" href="/public/assets/css/main.css" />
		<title>Profile</title>
		<script>
			function modify(){
			   if(document.getElementById("modifyId").readOnly==true){
				   document.getElementById("modifyId").readOnly=false;
				   document.getElementById("modifyButton").style.display="none"
				   if(document.getElementById("modifyButton2").style.display=="none")
				   document.getElementById("modifyButton2").style.display="block"
			   }
		   else{
			   document.getElementById("modifyId").readOnly=true;
			   document.getElementById("modifyButton").style.display="block"
			   if(document.getElementById("modifyButton2").style.display=="block")
				   document.getElementById("modifyButton2").style.display="none"
		   }
		   
			}
			   
	   
	   </script>
	</head>
	<body>
		<header id="header" class="alt">
			<h1><a href="/">Digital Of Pages</a> by 국직 잡스</h1>
			<nav id="nav">
				<ul>
					
					<li><a href="/logout">Logout</a></li>
					<li><a href="/">Home</a></li>

					<li>
						<a href="#" class="icon solid fa-angle-down">Menu</a>

						<ul>
							<li><a href="/public/generic.html">ABOUT US</a></li>
							<li><a href="/public/contact.html">Contact</a></li>
							<li><a href="/dev/announcement?page=0&request=dev">개발자 공지사항</a></li>
							<li><a href="/admin/announcement?page=0&request=admin">관리자 공지사항</a></li>
						
							<li><a href="/views/myPage">My Page</a></li>

							<li>
								<a href="#">Submenu</a>
								<ul>
									<li><a href="/profile">프로필</a></li>

									<li><a href="/book/listpost?page=0&perPage=2">도서목록</a></li>
									<li><a href="/book/listapplybook?page=0&perPage=2">신청도서목록</a></li>
									<li>
										<a class="btn btn-default" href="/user/requestlist?page=0&perPage=2">관리자 요청 계정 리스트</a>
									</li>
									<li>
										<a class="btn btn-default" href="#">소속원 등록</a>
									</li>
									<li>
										<a class="btn btn-default" href="/views/addbook.ejs">도서등록</a>
									</li>
									<li>
										<a class="btn btn-default" href="/views/applyNewBook.ejs?request=1"
											>도서신청</a
										>
									</li>
									<li>
										<a class="btn btn-default" href="/historyofbook?page=0&perPage=8"
											>독서 발자취</a
										>
									</li>
								</ul>
							</li>
							
						</ul>
					</li>
				
				</ul>
			</nav>
		</header>
		<br /><br />

		<div class="container mt-4">
			<h3>내 프로필</h3>
			<br />
			<div class="card mb-3" style="max-width: 540px;">
				<div class="row no-gutters" style="margin-top: 0; margin-left: 0em;">
					<div class="col-md-4">
						<!-- <input type="button" id="newWIndow" value="사진첨부" name="" /> -->
					</div>
					<div class="col-md-8">
						<div class="card-body">
							<h2 class="card-title">
								<form class="btn btn-default btn-sm"  method="post" action="/user/modifyUser">
									<input style="display:inline-block; width:50%" type="text" id="modifyId" readonly name="idmodify" value="<%= user.name %>">
									<input type="button" id="modifyButton" style="float:right;" value="수정" onclick="modify()" />
									<input type="submit" id="modifyButton2"  style="float:right; display:none;" value="완료" onclick="modify()" />
								</form>
							</h2>
								<h2 class="card-title">
								<form class="btn btn-default btn-sm"  method="post" action="/user/deleteUser">
									<input type="submit" id="modifyButton" style="float:right;" value="탈퇴" />
								</form>
							</h2>
							<p class="card-text">소속 부대: <strong><%= user.group %></strong></p>
							<p class="card-text">고유 번호/군번: <strong><%= user.own_number %></strong></p>
							<p class="card-text">
								<small class="text-muted"
									>총 대출 권 수 :
									<span class="badge badge-pill badge-success" onclick="javascript:window.location='/views/myPage'"><%=posts.reservationlist.length%></span></small
								>
							<% for (var i = 0; i < posts.reservationlist.length; i++) {
									console.log( posts.reservationlist);
										var borrow_day = posts.reservationlist[i].created_at;
										var today = new Date();
									
									console.log("today:"+today);
										var delayed_book=0;
										var dateTerm = Math.ceil((today.getTime()-borrow_day.getTime())/(1000*3600*24));
										if(borrow_day.getMonth==today.getMonth){
											dateTerm=(today.getDate()-borrow_day.getDate());
										}
										if(dateTerm>14){
											delayed_book++;
										}
										%>
								<small class="text-muted">연체 중인 도서 :
									<span class="badge badge-pill badge-success" onclick="javascript:window.location='/views/myPage'"><%=delayed_book%></span></small>
							<%}%>
							</p>
						</div>
					</div>
				</div>
			</div>
		</div>
		
		<br />
		<button
			type="button"
			class="btn btn-outline-secondary mt-2"
			onclick="location.href='/'"
			
		>
			Home
		</button>
		<!-- Footer -->
		<% include ./footer.ejs %>
	</body>
</html>