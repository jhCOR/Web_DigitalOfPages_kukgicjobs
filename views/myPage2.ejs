<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1">
		
		<title>마이페이지</title>
		<link rel="SHORTCUT ICON" href="/public/images/faviconlogo.png"/>

		<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.2/css/bootstrap.min.css"> <!-- load bootstrap css -->
    	<link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css"> <!-- load fontawesome -->
    				<link href="/public/bootstrap/css/bootstrap.min.css" rel="stylesheet" >
		<script src="/public/bootstrap/js/bootstrap.min.js"></script>

    	<style>
        	.wrap        { padding-top:80px; }
	
    	</style>

	</head>
	<body  class="landing is-preload">
			<% include ./header.ejs %>
		<div id="page-wrapper" class="container" >			
				
			<div class="page-header text-center">
		
		        <h1>마이페이지</h1>
		      
		    </div>
			
			<br>
		    <div class="row">
		
		        <div class="sm-6">
		            <div class="well">
		            
						
							
						<div >
							<h3>대출 중인 도서</h3>
							<div>
						
								<ul>
									<% 
									for (var i = 0; i < posts.reservationlist.length; i++) {
										var borrow_day = posts.reservationlist[i].updated_at;
										var today = new Date();
										var dateTerm = Math.ceil((today.getTime()-borrow_day.getTime())/(1000*3600*24));
										if(borrow_day.getMonth==today.getMonth){
											dateTerm=(today.getDate()-borrow_day.getDate());
										}
										if(dateTerm<=14){
										%>

										<li>
											<a href='/book/showbook/<%=posts.reservationlist[i]._id %>'>제목 : <%=posts.reservationlist[i].title%>, 저자 : 		  		<%=posts.reservationlist[i].author%></a>
											<a class="btn btn-default" href='/book/return/<%=posts.reservationlist[i]._id %>'>반납</a>
											<a class="btn btn-default" href='/book/loanByQrcode/<%=posts.reservationlist[i]._id %>?request=borrow'>QRcode_return</a>
										</li>
								
									<%}
									} %>	
								</ul>
							</div>
	
								
								<P></P>
							<h3>연체 중인 도서</h3>
							<div>
								<ul>
									<% for (var i = 0; i < posts.reservationlist.length; i++) {
										var borrow_day = posts.reservationlist[i].updated_at;
										var today = new Date();
										
										var dateTerm = Math.ceil((today.getTime()-borrow_day.getTime())/(1000*3600*24));
										if(borrow_day.getMonth==today.getMonth){
											dateTerm=(today.getDate()-borrow_day.getDate());
										}
										if(dateTerm>14){
										%>

										<li><a href='/book/showbook/<%=posts.reservationlist[i]._id %>'>제목 : <%=posts.reservationlist[i].title%>, 저자 : <%=posts.reservationlist[i].author%></a>
											<a class="btn btn-default" href='/book/return/<%=posts.reservationlist[i]._id %>'>반납</a>
											<a class="btn btn-default" href='/book/loanByQrcode/<%=posts.reservationlist[i]._id %>?request=borrow'>QRcode_return</a>
											
										</li>
								
									<% }
									} %>	
								</ul>
							</div>
								<a href='/' class="btn btn-outline-secondary" >홈으로</a>

			               
						</div>	

						<br>
						
		            </div>
		        </div>
		
		    </div>
			
		</div>	
			
			
	</body>


</html><div id="carouselExampleCaptions" class="carousel slide " data-bs-ride="carousel">
  <div class="carousel-indicators">
    <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
    <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="1" aria-label="Slide 2"></button>
    <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="2" aria-label="Slide 3"></button>
  </div>
  <div class="carousel-inner">
    <div class="carousel-item active">
      <img src="/public/images/book.png" class="d-block w-100" alt="...">
      <div class="carousel-caption d-none d-md-block">
        <h5>First slide label</h5>
        <p>Some representative placeholder content for the first slide.</p>
      </div>
    </div>
    <div class="carousel-item">
      <img src="/public/images/lucky.png" class="d-block w-100" alt="...">
      <div class="carousel-caption d-none d-md-block">
        <h5>Second slide label</h5>
        <p>Some representative placeholder content for the second slide.</p>
      </div>
    </div>
    <div class="carousel-item">
      <img src="/public/images/laptopWithNote.png" class="d-block w-100" alt="...">
      <div class="carousel-caption d-none d-md-block">
        <h5>Third slide label</h5>
        <p>Some representative placeholder content for the third slide.</p>
      </div>
    </div>
  </div>
  <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="prev">
    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Previous</span>
  </button>
  <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Next</span>
  </button>
</div>

<body>
	
		<div class="container" id="app-6">
		
			<div class="ui raised segment">
				
					<form class="btn-default btn-sm"  method="post" action="/user/friend">
					<input  style="width:20%; heigt:1.5em; float:left;" name="friend"  >
					<button type="submit" class="btn btn-warning " >찾기</button>
					</form>	 
				
				<div class="ui blue fluid card">
					 <div class="content">
							<span class="image featured left floated author">
								<img class="img-fluid" id="profileimg"  style="width:8em; heigt:8em; margin-top:5%; margin-left:20%;" src="" alt="프로필 사진 선택"  /><input hidden name="photo" id="photoInput"  type="file" accept="image/*">
								<input hidden id="photopath"  type="text" value="<%=profile%>">
							</span>
	   					<div class="meta">
							<p class="card-text">아이디: <strong><%= user.name %></strong></p>
	     					<p class="card-text" id="id_email"><strong><%=user.email %></strong></p>
							<p class="card-text">소속 부대: <strong><%= user.group %></strong></p>
							<p class="card-text">고유 번호/군번: <strong><%= user.own_number %></strong></p>
	     				</div>
	   						
					 </div>
	  				<div class="extra content" v-if="datas[0]=='none'">
	    					<input type="button" value="친구요청"  v-on:click="request()"/>
	  				</div>
				</div> 
				<input   class="ui button align" type="button" value="북 히스토리" name="" v-on:click="getData()" v-if="!bookLog" />
				<input   class="ui button align"  style="color:orange;" type="button" value="북 히스토리" name="" v-on:click="getData()" v-if="bookLog"/>
				<input   class="ui button align" type="button" value="리뷰 히스토리" name="" v-on:click="turntoreview()"  v-if="bookLog" />
				<input   class="ui button align"   style="color:orange;" type="button" value="리뷰 히스토리" name="" v-on:click="turntoreview()"  v-if="!bookLog" />
				<div  style="overflow:scroll; width:100%; height:400px;">
					<div class="ui blue fluid card"  v-if="!bookLog" v-for="data in datas"   v-on:click="show(data._id)">
                                <div class="content">
                                    <div class="sixteen wide column">
                                        <div class="ui header" style="inline-block">
                                            <h4 class="ui left aligned header ">
                                                {{data.contents}}
                                            </h4>
                                      <h5 class="ui left aligned header ">
                                                {{data.created_at}}
                                            </h5>
												
                                        </div>
										
                                    </div>
									
										
                                </div>
                            </div>
					
						<div class="ui blue fluid card" v-if="bookLog" v-for="booklog in BookLogdatas"   v-on:click="show(booklog.bookInfo._id)">
                                <div class="content">
                                    <div class="sixteen wide column">
                                        <div class="ui header" style="inline-block">
                                            <h4 class="ui left aligned header ">
                                                {{booklog.bookInfo.title}}
                                            </h4>
                                			 <h5 class="ui left aligned header ">
                                                {{booklog.created_at}}
                                            </h5>
												
                                        </div>
										
                                    </div>
									
										
                                </div>
                            </div>
	
				</div>
				
       
			</div>
					<button type="button" class="btn btn-outline-secondary mt-2" onclick="location.href='/'">Home</button>
	
		</div>
			
			<script>
		var app6 = new Vue({
		  el: '#app-6',
		  data: {
			datas: [],
			 BookLogdatas: [],
			  bookLog:false,
			  showInput:false
		  },
		mounted() {
			this.$nextTick(function () {
				var friendEmail = document.getElementById('id_email').innerText;
				console.log("sended");
				this.$http.get('/user/friend_profile_reivew?email='+friendEmail) 
						.then(function(response) {
						  console.log(response);   
						  this.datas = response.data


				});
				 
		    })
		},
        methods: {
			show:function(id){
				window.location='/book/showbook/'+id;
				
			},
			
			turntoreview:function(){
				  this.bookLog = false;
				
			},
			
			getData: function() {
				var friendEmail = document.getElementById('id_email').innerText;
					if(this.datas[0]!='none'){
							  this.bookLog = true;
    		this.$http.get('/user/friend_profile_bookLog?email='+friendEmail) 
					.then(function(response) {
					  this.BookLogdatas = response.data;
		
 				
					});
						
					}
			
			  },
			request: function() {
				var friendEmail = document.getElementById('id_email').innerText;
    		
				axios.post('/user/sendRecommand',{ request: friendEmail})
					 .then(function(response) {
						
					 })
					.catch(function(error) {

					 });
				alert('요청 완료');
			},
    	},

		});

		</script>
	</body>